# Проект - Cinema
[![Build Status](https://travis-ci.org/DmitriyYugai/job4j_cinema.svg?branch=master)](https://travis-ci.org/DmitriyYugai/job4j_cinema)

# Содержание
* [Использованные технологии](#Использованные-технологии)
* [О проекте](#О-проекте)
* [Сборка](#Сборка)
* [Использование](#Использование)
* [Контакты](#Контакты)
## Использованные технологии
* Servlets
* PostgreSQL
* Collections Framework
* SLF4J и Log4j
* Библиотека GSON
* Apache Commons DBCP (Database Connection Pooling)
* HTML, CSS
* JS, JQuery, Bootstrap
* AJAX
* Travis CI
## О проекте
* Приложение представляет собой веб-сайт по покупке билетов в кинотеатр:<br><br>
![Главная страница](img/about/index.PNG)<br><br>
Как видно, на главной странице отображается зал с рядами.<br><br>
* Если место забронировано, то это отображается в таблице:<br><br>
![Место занято](img/about/busy.PNG)<br><br>
* На главной странице используется динамическое обновление контента с помощью AJAX (ежесекундно).<br><br>
* После того как пользователь выбрал место, можно перейти на страницу оплаты:<br><br>
![Оплата](img/about/payment.PNG)<br><br>
Здесь указывается ФИО пользователя и его номер.<br><br>
* Страницы реализованы на HTML и Bootstrap<br><br>
* Для корректной обработки ситуации, в которой несколько пользователей одновременно бронируют одно и то же место, 
осуществляется проверка как на стороне клиента (с помощью JS), так и на стороне сервера.<br><br>
* Для работы с JSON используется библиотека GSON<br><br>
* Большинство операций осуществляется на стороне клиента с помощью JS, JQuery и AJAX-запросов. 
Сервер лишь сохраняет или отправляет данные в JSON-формате<br><br>
* Все запросы к серверу посылаются в виде AJAX-запросов<br><br>
* Реализована валидация вводимых пользователем данных с помощью нативного JS:<br><br>
![Валидация 1](img/about/valid1.PNG)<br><br>
![Валидация 2](img/about/valid2.PNG)<br><br>
* На сервере реализовано 2 слоя: слой контроллеров и слой по работе с БД. Слой контроллеров реализован на сервлетах. 
Слой по работе с БД - на JDBC.<br><br>
* В качестве БД используется PostgreSQL.<br><br>
* Пул соединений к БД основан на Apache Commons DBCP2<br><br> 
* В качестве системы логирования используется slf4j, который использует log4j.
## Сборка
1. Установить JDK 14.
2. Скачать Maven.
3. Создать переменные окружения JAVA_HOME и M2_HOME и прописать в переменную окружения Path 
пути до бинарных файлов для JDK и для Maven:<br><br>
![Java Maven installing](img/build/java_maven.PNG)<br><br>
4. Установить сервер БД PostgreSQL. При установке задать:<br>
    * имя пользователя - postgres 
    * пароль - root
    * порт - 5432<br>
Также при установке сервера БД PostgreSQL нужно установить программу pg_Admin.

5. Скачать и установить Tomcat.
6. Скачать исходный код проекта с GitHub.
7. Перейти в корень проекта, где лежит файл pom.xml:<br><br>
![Переход в корень проекта 1](img/build/cd.PNG)<br><br>
![Переход в корень проекта 2](img/build/cd1.PNG)<br><br>
8. С помощью Maven осуществить сборку проекта:<br><br>
![Сборка проекта](img/build/package.PNG)<br><br>
При успешной сборке должна появиться папка target, в которой располагается war-архив:<br><br>
![Сборка прошла успешно](img/build/package1.PNG)<br><br>
![Папка target](img/build/target.PNG)<br><br>
![war-архив](img/build/target1.PNG)<br><br>
9. Переименовать war-архив:<br><br>
![Переименовать war-архив](img/build/target3.PNG)<br><br>
10. Запустить сервер БД, указав путь до папки data:<br><br>
![Запуск сервера БД](img/build/server_start.PNG)<br><br>
11. Запустить программу pg_Admin, установленную вместе с сервером БД PostgreSQL:<br><br>
![Запуск pg_Admin](img/build/pg_admin.PNG)<br><br>
12. Создать БД с названием cinema:<br><br>
![БД dreamjob](img/build/cinema_db.PNG)<br><br>
13. Открыть Query Tool для созданной БД и запустить SQL-скрипт create.sql, 
находящийся в папке db (данная папка находится в корне скачанного проекта):<br><br>
![Скрипт schema.sql](img/build/script.PNG)<br><br>
![Запуск скрипта schema.sql](img/build/pg_admin_script.PNG)<br><br>
14. Задеплоить собранный war-архив в папку webapps, находящуюся в корневой папке скачанного Tomcat:<br><br>
![Деплой war-архива 1](img/build/deploy.PNG)<br><br>
15. Скопировать файл db_cinema.properties, находящийся в корне скачанного проекта в папку bin, 
находящуюся в корневой папке скачанного Tomcat:<br><br>
![Деплой war-архива 2](img/build/deploy1.PNG)<br><br>
![Деплой war-архива 3](img/build/deploy2.PNG)<br><br>
Сборка завершена. Теперь можно проверить работу приложения.
## Использование
Запускаем Tomcat:<br><br>
![Запуск Tomcat 1](img/usage/tomcat_start.PNG)<br><br>
![Запуск Tomcat 2](img/usage/tomcat_start1.PNG)<br><br>
Переходим на главную страницу приложения
[http://localhost:8080/cinema/](http://localhost:8080/cinema/): <br><br>
![Главная страница](img/usage/index.PNG)<br><br>
Забронируем первое место в первом ряду:<br><br>
![Бронирование места 1](img/usage/book1.PNG)<br><br>
![Бронирование места 2](img/usage/book2.PNG)<br><br>
![Бронирование места 3](img/usage/book3.PNG)<br><br>
![Бронирование места 4](img/usage/book4.PNG)<br><br>
Проверим валидацию. Нажмём кнопку "Оплатить" на главной странице, при этом не выбрав место:<br><br>
![Проверка валидации 1](img/usage/valid1.PNG)<br><br>
Теперь проверим валидацию формы:<br><br>
![Проверка валидации 2](img/usage/valid2.PNG)<br><br>
Как видно, валидация работает.<br><br>
Сымитируем ситуацию, в которой несколько клиентов пытаются забронировать одно и то же место.<br><br>
Пусть первый клиент начинает бронировать второе место в первом ряду:<br><br>
![Коллизия 1](img/usage/col1.PNG)<br><br>
![Коллизия 2](img/usage/col2.PNG)<br><br>
В это время второй клиент полностью бронирует второе место в первом ряду:<br><br>
![Коллизия 3](img/usage/col3.PNG)<br><br>
![Коллизия 4](img/usage/col4.PNG)<br><br>
![Коллизия 5](img/usage/col5.PNG)<br><br>
![Коллизия 6](img/usage/col6.PNG)<br><br>
Теперь возвращаемся к первому клиенту:<br><br>
![Коллизия 2](img/usage/col2.PNG)<br><br>
Нажимаем кнопку "Оплатить":<br><br>
![Коллизия 7](img/usage/col7.PNG)<br><br>
Как видно, в данной ситуации приложение отрабатывает корректно.
## Контакты
Почта: studentnstu97@mail.ru<br>
Skype: live:.cid.9cdc925fb48220b4